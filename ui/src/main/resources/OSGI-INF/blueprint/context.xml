<blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0"
    xmlns:cm="http://aries.apache.org/blueprint/xmlns/blueprint-cm/v1.1.0">

    <!-- Configuration from $KARAF_HOME/etc/org.apromore.cfg -->
    <cm:property-placeholder persistent-id="org.apromore" update-strategy="reload">
        <cm:default-properties>
            <cm:property name="ui.theme" value="breeze"/>
<!--
            <cm:property name="ui.menuorder" value="Account,Item,Discover,Analyze,Redesign,Implement,Monitor"/>
-->
        </cm:default-properties>
    </cm:property-placeholder>

    <bean id="uiMenuOrder" class="java.lang.String">
<!--
        <argument type="java.lang.String" value="Account,Item,Discover,Analyze,Redesign,Implement,Monitor"/>
-->
        <argument type="java.lang.String" value="${ui.menuorder}"/>
    </bean>

    <bean id="uiTheme" class="java.lang.String">
        <argument type="java.lang.String" value="${ui.theme}"/>
    </bean>

    <!-- Tools are installed in the menubar and can use the selection to obtain Items they require as input. -->
    <bean id="uiPluginListener" class="org.apromore.ui.impl.UIPluginListener"/>
    <reference-list id="uiPlugins" interface="org.apromore.ui.spi.UIPlugin" availability="optional">
        <reference-listener ref="uiPluginListener" bind-method="onBind" unbind-method="onUnbind"/>
    </reference-list>

    <!-- User interface service -->
    <service interface="org.apromore.ui.UIService">
        <bean class="org.apromore.ui.impl.UIServiceImpl">
            <property name="loginConfigurationName" value="${jaas.loginConfigurationName}"/>
            <property name="userPrincipalClass" value="${jaas.userPrincipalClass}"/>
<!--
            <property name="loginConfigurationName" value="apromore"/>
            <property name="userPrincipalClass" value="org.apache.karaf.jaas.boot.principal.UserPrincipal"/>
-->
        </bean>
    </service>

    <!-- ZK listener for cleanup when a session is destroyed -->
    <service interface="javax.servlet.http.HttpSessionListener" ranking="3">
        <service-properties>
            <entry key="osgi.http.whiteboard.listener" value="true"/>
        </service-properties>
        <bean class="org.zkoss.zk.ui.http.HttpSessionListener"/>
    </service>

    <!-- ZK loader for ZUML pages -->
    <service interface="javax.servlet.Servlet" ranking="2">
        <service-properties>
            <entry key="osgi.http.whiteboard.servlet.pattern" value="*.zul"/>
            <entry key="osgi.http.whiteboard.servlet.name" value="zkLoader"/>
            <entry key="servlet.init.log-level" value="DEBUG"/>
            <entry key="servlet.init.update-uri" value="/zkau"/>
        </service-properties>
        <bean class="org.zkoss.zk.ui.http.DHtmlLayoutServlet"/>
    </service>

    <!-- The asynchronous update engine for ZK -->
    <service interface="javax.servlet.Servlet" ranking="1">
        <service-properties>
            <entry key="osgi.http.whiteboard.servlet.pattern" value="/zkau/*"/>
            <entry key="osgi.http.whiteboard.servlet.name" value="auEngine"/>
        </service-properties>
        <bean class="org.zkoss.zk.au.http.DHtmlUpdateServlet"/>
    </service>

<!--
    <service interface="javax.servlet.Servlet">
        <service-properties>
            <entry key="osgi.http.whiteboard.servlet.pattern" value="/"/>
            <entry key="osgi.http.whiteboard.servlet.name" value="defaultServlet"/>
            <entry key="servlet.init.test-init-parameter" value="Default"/>
        </service-properties>
        <bean class="org.apromore.ui.impl.TestServlet"/>
    </service>
-->

    <!-- Resource service -->
    <service interface="java.io.Serializable">
        <service-properties>
            <entry key="osgi.http.whiteboard.resource.pattern" value="/css/*"/>
            <entry key="osgi.http.whiteboard.resource.prefix"  value="/css"/>
        </service-properties>
        <bean class="java.lang.String"/>
    </service>

    <service interface="java.io.Serializable">
        <service-properties>
            <entry key="osgi.http.whiteboard.resource.pattern" value="/img/*"/>
            <entry key="osgi.http.whiteboard.resource.prefix"  value="/img"/>
        </service-properties>
        <bean class="java.lang.String"/>
    </service>

</blueprint>
